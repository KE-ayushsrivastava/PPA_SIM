import React, { useContext } from "react";
import { useNavigate } from "react-router-dom";
import { AuthContext } from "../contexts/AuthContext"; // path adjust karo
import {
  Drawer,
  List,
  ListItemButton,
  ListItemIcon,
  ListItemText,
  Tooltip,
  Box,
  Button,
  IconButton,
  Typography,
} from "@mui/material";
import DashboardIcon from "@mui/icons-material/Dashboard";
import TrendingUpIcon from "@mui/icons-material/TrendingUp";
import BusinessIcon from "@mui/icons-material/Business";
import LogoutIcon from "@mui/icons-material/Logout";
import InfoIcon from "@mui/icons-material/Info";
import ArticleIcon from "@mui/icons-material/Article";
import CompareArrowsIcon from "@mui/icons-material/CompareArrows";
import ShowChartIcon from "@mui/icons-material/ShowChart";
import sidebarBg from "../assets/img/sidebar_bg.png";

import orgLogo from "../assets/img/kelogo.png";
import orgLogo2 from "../assets/img/kelogo2.png";
import "../assets/css/Sidebar.css";
import { useThemeMode } from "./ThemeModeContext";

export const drawerWidth = 200;
export const collapsedWidth = 72;

const iconMap = {
  "Read Me": <InfoIcon />,
  SOP: <ArticleIcon />,
  "Result Comparison": <CompareArrowsIcon />,
  "Price Charts": <ShowChartIcon />,
};

export default function Sidebar({
  tabs = ["Read Me", "SOP", "Result Comparison", "Price Charts"],
  onSelect = () => {},
  open = true,
  activeTab,
  toggleDrawer,
}) {
  const { logout } = useContext(AuthContext);
  const { user } = useContext(AuthContext);
  const navigate = useNavigate();

  const handleLogout = async () => {
    await logout();
    navigate("/"); // ðŸ‘ˆ redirect here
  };

  const { mode } = useThemeMode();

  const sidebarStyles =
    mode === "dark"
      ? {
          backgroundColor: "#1F1B2E", // dark sidebar bg
          textColor: "#E0E0E0 !important",
          activeBg: "#6C7AE0 !important",
          activeText: "#FFFFFF !important",
          hoverBg: "rgba(108, 99, 255, 0.15) !important",
          hoverText: "#6C7AE0 !important",
        }
      : {
          backgroundColor: "#6C7AE0", // âœ… sidebar bg in light
          textColor: "#FFFFFF !important", // âœ… default font color
          activeBg: "#FFFFFF !important", // âœ… active tab bg
          activeText: "#6C7AE0 !important", // âœ… active tab font
          hoverBg: "#FFFFFF !important", // âœ… hover bg on inactive tab
          hoverText: "#6C7AE0 !important", // âœ… hover text on inactive tab
        };

  const width = open ? drawerWidth : collapsedWidth;
  return (
    <Box component="nav" className="sidebar-container" style={{ width }}>
      <Drawer
        variant="permanent"
        anchor="left"
        PaperProps={{
          className: "sidebar-paper",
          style: {
            width,
            backgroundColor: sidebarStyles.backgroundColor,
            color: sidebarStyles.textColor,
          },
        }}
        open
      >
        {/* Logo */}
        <Box className="sidebar-logo-wrapper">
          <img
            src={open ? orgLogo : orgLogo2}
            alt="Organization Logo"
            className={`sidebar-logo ${open ? "open" : "collapsed"}`}
          />
        </Box>
        <Box sx={{ borderBottom: "1px solid #ccc", paddingBottom: "5px" }}>
          {user ? (
            <Typography
              variant="subtitle1"
              fontWeight={600}
              fontSize={"0.8rem"}
              color="white"
              sx={{ textAlign: "center", display: open ? "block" : "none" }}
            >
              Welcome {user.username}
            </Typography>
          ) : (
            <Typography
              variant="subtitle1"
              fontWeight={600}
              color="white"
              sx={{ textAlign: open ? "left" : "center" }}
            >
              Welcome
            </Typography>
          )}
        </Box>
        {/* Tab list */}
        <Box sx={{ flexGrow: 1 }}>
          <List disablePadding className="sidebar-tabs">
            {tabs.map((tab) => (
              <Tooltip
                key={tab}
                title={open ? "" : tab}
                placement="right"
                arrow
              >
                <ListItemButton
                  onClick={() => onSelect(tab)}
                  selected={activeTab === tab}
                  className="sidebar-item"
                  sx={{
                    color:
                      activeTab === tab
                        ? sidebarStyles.activeText
                        : sidebarStyles.textColor,
                    backgroundColor:
                      activeTab === tab
                        ? sidebarStyles.activeBg
                        : "transparent",
                    fontWeight: activeTab === tab ? 600 : 400,
                    "&:hover": {
                      backgroundColor:
                        activeTab === tab
                          ? sidebarStyles.activeBg // active tab hover â†’ same bg
                          : sidebarStyles.hoverBg,
                      color:
                        activeTab === tab
                          ? sidebarStyles.activeText // active tab hover â†’ same font
                          : sidebarStyles.hoverText,
                      "& .MuiListItemIcon-root": {
                        color: "#6C7AE0", // âœ… change icon color on hover
                      },
                      "& .MuiListItemText-root": {
                        color: "#6C7AE0", // âœ… change text color on hover
                      },
                    },
                  }}
                >
                  <ListItemIcon
                    sx={{
                      minWidth: 0,
                      mr: open ? 2 : 0,
                      justifyContent: "center",
                      color: activeTab === tab ? "#6C7AE0" : "#FFF",
                    }}
                  >
                    {iconMap[tab] ?? <DashboardIcon />}
                  </ListItemIcon>
                  {open && (
                    <ListItemText
                      primary={tab}
                      primaryTypographyProps={{
                        fontSize: "0.8rem", // âœ… professional font size
                        fontWeight: activeTab === tab ? 600 : 600,
                      }}
                    />
                  )}
                </ListItemButton>
              </Tooltip>
            ))}
          </List>
        </Box>
        <Box className="sidebar-spacer"></Box>

        {/* Logout */}
        <Box sx={{ mb: 2, borderTop: "1px solid #ccc" }}>
          <Tooltip
            key="Logout"
            title={open ? "" : "Logout"}
            placement="right"
            arrow
          >
            <ListItemButton
              onClick={handleLogout}
              sx={{
                mx: 1,
                my: 1,
                py: 0,
                borderRadius: "8px",
                backgroundColor: "transparent",
                color: "#fff",
                "&:hover": {
                  backgroundColor: "#FFF",
                  color: "#6C7AE0",
                  "& .MuiListItemIcon-root": {
                    color: "#6C7AE0", // âœ… change icon color on hover
                  },
                  "& .MuiListItemText-root": {
                    color: "#6C7AE0", // âœ… change text color on hover
                  },
                },
              }}
            >
              <ListItemIcon
                sx={{
                  minWidth: 0,
                  mr: open ? 2 : 0,
                  justifyContent: "center",
                  color: "#FFF",
                }}
              >
                <LogoutIcon />
              </ListItemIcon>
              {open && (
                <ListItemText
                  primary="Logout"
                  primaryTypographyProps={{
                    fontSize: "0.8rem",
                    fontWeight: 600,
                  }}
                />
              )}
            </ListItemButton>
          </Tooltip>
        </Box>
      </Drawer>
    </Box>
  );
}
